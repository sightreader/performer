{"ast":null,"code":"var _jsxFileName = \"C:\\\\code\\\\sightreader\\\\performer\\\\src\\\\ScorePane.tsx\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useState, useRef, useEffect } from \"react\";\nimport { createStyles, makeStyles } from \"@material-ui/core/styles\";\nimport { Box } from \"@material-ui/core\";\nimport MenuBookTwoToneIcon from \"@material-ui/icons/MenuBookTwoTone\";\nimport { SightReaderClient } from \"./SightReaderClient\";\nconst useStyles = makeStyles(theme => createStyles({\n  paperTableContainer: {\n    marginTop: theme.spacing(3),\n    width: \"100%\",\n    overflowX: \"auto\",\n    marginBottom: theme.spacing(2),\n    background: theme.palette.primary.light\n  },\n  tableCell: {\n    cursor: \"pointer\"\n  },\n  root: {\n    padding: \"2px 4px\",\n    display: \"flex\",\n    alignItems: \"center\",\n    width: 400,\n    background: theme.palette.primary.light\n  },\n  input: {\n    marginLeft: theme.spacing(1),\n    flex: 1\n  },\n  iconButton: {\n    padding: 10\n  },\n  divider: {\n    height: 28,\n    margin: 4\n  },\n  activeScoreSection: {\n    marginBottom: theme.spacing(2)\n  },\n  stage: {\n    width: \"100%\",\n    height: \"100%\",\n    padding: 10,\n    paddingLeft: 5\n  },\n  noScoreLoadedIcon: {\n    color: theme.palette.primary.dark,\n    width: \"23vw\",\n    height: \"auto\",\n    transform: \"translateY(-10%)\",\n    opacity: 0.3\n  }\n}));\nexport default function ScorePane() {\n  const classes = useStyles();\n  const stageRef = useRef(null);\n  const {\n    0: pageSvg,\n    1: setPageSvg\n  } = useState(\"\");\n  const {\n    0: pageNumber,\n    1: setPageNumber\n  } = useState(1);\n  const measureHighlightTrebleRef = useRef(null);\n  const measureHighlightBassRef = useRef(null);\n  const {\n    0: measureNumbers,\n    1: setMeasureNumbers\n  } = useState([1, 1]);\n  const {\n    0: bassMeasureHighlightDetails,\n    1: setTrebleMeasureHighlightDetails\n  } = useState({\n    top: 0,\n    left: 0,\n    width: 0,\n    height: 0\n  });\n  const {\n    0: trebleMeasureHighlightDetails,\n    1: setBassMeasureHighlightDetails\n  } = useState({\n    top: 0,\n    left: 0,\n    width: 0,\n    height: 0\n  });\n  useEffect(() => {\n    highlightMeasure(1, measureNumbers[0]);\n    highlightMeasure(2, measureNumbers[0]);\n  }, [measureNumbers]);\n  useEffect(() => {\n    if (SightReaderClient.Instance.Score.length === 0 || !stageRef || !stageRef.current) {\n      return;\n    }\n\n    var stageBounds = stageRef.current.getBoundingClientRect();\n    SightReaderClient.Instance.setupScore({\n      pageHeight: stageBounds.height * window.devicePixelRatio,\n      pageWidth: stageBounds.width * 3,\n      scale: 100\n      /* Scale 100 means pageHeight and pageWidth are pixel units: https://github.com/rism-ch/verovio/issues/1055 */\n      ,\n      adjustPageHeight: false\n    }).then(() => {\n      return rerenderScore(pageNumber);\n    }).then(() => {\n      highlightMeasure(1, measureNumbers[0]);\n      highlightMeasure(2, measureNumbers[0]);\n    });\n  }, [SightReaderClient.Instance.Score]);\n\n  async function rerenderScore(page) {\n    setPageNumber(page);\n    console.log(\"Rendering Page:\", page);\n    return SightReaderClient.Instance.renderScore(page).then(svg => {\n      setPageSvg(svg);\n    });\n  }\n\n  if (false) {\n    window.rerenderScore = rerenderScore;\n  }\n\n  useEffect(() => {\n    rerenderScore(pageNumber);\n    window.pageNumber = pageNumber;\n  }, [pageNumber]);\n\n  if (false) {\n    window.pageNumber = pageNumber;\n  }\n\n  SightReaderClient.Instance.setSetScoreDisplayPositionRequestedCallback(onSetScoreDisplayPositionRequested);\n\n  function onSetScoreDisplayPositionRequested(command) {\n    console.log(\"Received final set score display position request:\", command.MeasureNumbers, command.GroupIndices);\n    var highestPlayedMeasure = Math.max(...command.MeasureNumbers);\n    var measureRange = getPageMeasureRange();\n    var [lowestMeasureDisplayed, highestMeasureDisplayed] = measureRange;\n\n    if (highestPlayedMeasure < lowestMeasureDisplayed) {\n      setPageNumber(Math.max(0, pageNumber - 1));\n    } else if (highestPlayedMeasure > highestMeasureDisplayed) {\n      setPageNumber(pageNumber + 1);\n    } else {\n      highlightMeasure(1, command.MeasureNumbers[0]);\n      highlightMeasure(2, command.MeasureNumbers[1]);\n    }\n  }\n\n  function getPageMeasureRange() {\n    const navigableMeasureNumberEl = document.querySelector(\".mNum\");\n\n    if (!navigableMeasureNumberEl) {\n      console.error(\"Cannot highlight measure because no measure numbers are present on any system on the page.\");\n      return [-1, -1];\n    }\n\n    const navigableMeasureNumber = navigableMeasureNumberEl.textContent ? +navigableMeasureNumberEl.textContent.trim() : -1;\n\n    if (navigableMeasureNumber === -1) {\n      console.error(\"Found measure number element .mNum, but it has no text content so cannot extract measure number.\");\n      return [-1, -1];\n    }\n\n    const navigableMeasureEl = navigableMeasureNumberEl.closest(\".measure\");\n    const pageMeasures = document.querySelectorAll(\".measure\");\n    const navigableMeasureNumberElIndex = -1;\n    let measureRangeLow = 0;\n    let measureRangeHigh = 0;\n    let measuresBeforeNavigable = 0;\n    let measuresAfterNavigable = 0;\n    let foundTargetMeasureEl = false;\n    pageMeasures.forEach(measureEl => {\n      if (foundTargetMeasureEl) {\n        return;\n      }\n\n      if (measureEl === navigableMeasureEl) {\n        measuresAfterNavigable = pageMeasures.length - measuresBeforeNavigable - 1;\n        foundTargetMeasureEl = true;\n      } else {\n        measuresBeforeNavigable += 1;\n      }\n    });\n    measureRangeLow = navigableMeasureNumber - measuresBeforeNavigable;\n    measureRangeHigh = navigableMeasureNumber + measuresAfterNavigable;\n    return [measureRangeLow, measureRangeHigh];\n  }\n\n  if (false) {\n    window.getPageMeasureRange = getPageMeasureRange;\n  }\n\n  function highlightMeasure(staff, targetMeasureNum) {\n    if (SightReaderClient.Instance.Score.length === 0) {\n      return;\n    }\n\n    const [measureRangeLow, measureRangeHigh] = getPageMeasureRange();\n\n    if (targetMeasureNum < measureRangeLow || targetMeasureNum > measureRangeHigh) {\n      console.error(`Cannot highlight measure ${targetMeasureNum}. This page only shows measures ${measureRangeLow} - ${measureRangeHigh}.`);\n    }\n\n    const relativeMeasureNum = targetMeasureNum - measureRangeLow;\n    const measureEls = document.querySelectorAll(`.measure`);\n    const measureEl = measureEls[relativeMeasureNum];\n\n    if (!measureEl) {\n      return;\n    }\n\n    const staffEl = measureEl.querySelectorAll(\".staff\")[staff - 1];\n\n    if (!staffEl) {\n      console.error(\"Could not highlight staff\", staff, \"of measure\", targetMeasureNum, \". The measure element was:\", measureEl);\n      return;\n    }\n\n    const staffBoundingBox = staffEl.getBoundingClientRect();\n\n    if (staff === 1) {\n      setTrebleMeasureHighlightDetails({\n        top: staffBoundingBox.top,\n        left: staffBoundingBox.left,\n        width: staffBoundingBox.width,\n        height: staffBoundingBox.height\n      });\n    } else if (staff === 2) {\n      setBassMeasureHighlightDetails({\n        top: staffBoundingBox.top,\n        left: staffBoundingBox.left,\n        width: staffBoundingBox.width,\n        height: staffBoundingBox.height\n      });\n    } else {\n      console.error(\"Unknown staff\", staff, \"to highlight measure for.\");\n    }\n  }\n\n  if (false) {\n    window.highlightMeasure = highlightMeasure;\n  }\n\n  return __jsx(Box, {\n    flexGrow: 1,\n    flexShrink: 0,\n    maxWidth: 1024,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 316\n    },\n    __self: this\n  }, pageSvg.length === 0 && __jsx(Box, {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    height: \"100%\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 318\n    },\n    __self: this\n  }, __jsx(MenuBookTwoToneIcon, {\n    className: classes.noScoreLoadedIcon,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 324\n    },\n    __self: this\n  })), __jsx(_JSXStyle, {\n    id: \"918444649\",\n    __self: this\n  }, \"#stage .system>polygon{display:none;}#stage .rest{display:none;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxjb2RlXFxzaWdodHJlYWRlclxccGVyZm9ybWVyXFxzcmNcXFNjb3JlUGFuZS50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBc1V5QixBQUl3QixBQUtBLGFBSmYsQUFLQSIsImZpbGUiOiJDOlxcY29kZVxcc2lnaHRyZWFkZXJcXHBlcmZvcm1lclxcc3JjXFxTY29yZVBhbmUudHN4Iiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IHVzZVN0YXRlLCB1c2VSZWYsIHVzZUVmZmVjdCB9IGZyb20gXCJyZWFjdFwiO1xyXG5pbXBvcnQgQ29udGFpbmVyIGZyb20gXCJAbWF0ZXJpYWwtdWkvY29yZS9Db250YWluZXJcIjtcclxuaW1wb3J0IHtcclxuICBjcmVhdGVTdHlsZXMsXHJcbiAgVGhlbWUsXHJcbiAgbWFrZVN0eWxlcyxcclxuICByZ2JUb0hleFxyXG59IGZyb20gXCJAbWF0ZXJpYWwtdWkvY29yZS9zdHlsZXNcIjtcclxuaW1wb3J0IEFwcEJhciBmcm9tIFwiQG1hdGVyaWFsLXVpL2NvcmUvQXBwQmFyXCI7XHJcbmltcG9ydCBUb29sYmFyIGZyb20gXCJAbWF0ZXJpYWwtdWkvY29yZS9Ub29sYmFyXCI7XHJcbmltcG9ydCBBY2NvdW50Q2lyY2xlIGZyb20gXCJAbWF0ZXJpYWwtdWkvaWNvbnMvQWNjb3VudENpcmNsZVwiO1xyXG5pbXBvcnQgQWRkSWNvbiBmcm9tIFwiQG1hdGVyaWFsLXVpL2ljb25zL0FkZFwiO1xyXG5pbXBvcnQgTWVudUl0ZW0gZnJvbSBcIkBtYXRlcmlhbC11aS9jb3JlL01lbnVJdGVtXCI7XHJcbmltcG9ydCBNZW51IGZyb20gXCJAbWF0ZXJpYWwtdWkvY29yZS9NZW51XCI7XHJcbmltcG9ydCBUeXBvZ3JhcGh5IGZyb20gXCJAbWF0ZXJpYWwtdWkvY29yZS9UeXBvZ3JhcGh5XCI7XHJcbmltcG9ydCB7IENsaWVudCB9IGZyb20gXCIuLi9zcmMvQ2xpZW50L0NsaWVudFwiO1xyXG5pbXBvcnQgU2V0dGluZ3NJbnB1dFN2aWRlb1R3b1RvbmVJY29uIGZyb20gXCJAbWF0ZXJpYWwtdWkvaWNvbnMvU2V0dGluZ3NJbnB1dFN2aWRlb1R3b1RvbmVcIjtcclxuaW1wb3J0IHtcclxuICBGYWIsXHJcbiAgQm94LFxyXG4gIFBhcGVyLFxyXG4gIEZvcm1Hcm91cCxcclxuICBGb3JtQ29udHJvbExhYmVsLFxyXG4gIFN3aXRjaCxcclxuICBJbnB1dEJhc2VcclxufSBmcm9tIFwiQG1hdGVyaWFsLXVpL2NvcmVcIjtcclxuaW1wb3J0IFNldHRpbmdzSWNvbiBmcm9tIFwiQG1hdGVyaWFsLXVpL2ljb25zL1NldHRpbmdzXCI7XHJcbmltcG9ydCBNZW51SWNvbiBmcm9tIFwiQG1hdGVyaWFsLXVpL2ljb25zL01lbnVcIjtcclxuaW1wb3J0IE1lbnVCb29rVHdvVG9uZUljb24gZnJvbSBcIkBtYXRlcmlhbC11aS9pY29ucy9NZW51Qm9va1R3b1RvbmVcIjtcclxuaW1wb3J0IGNsc3ggZnJvbSBcImNsc3hcIjtcclxuaW1wb3J0IHsgU2lnaHRSZWFkZXJDbGllbnQgfSBmcm9tIFwiLi9TaWdodFJlYWRlckNsaWVudFwiO1xyXG5pbXBvcnQge1xyXG4gIEVudW1lcmF0ZU1pZGlEZXZpY2VzUmVzcG9uc2UsXHJcbiAgRW51bWVyYXRlU2NvcmVzUmVzcG9uc2UsXHJcbiAgU2V0U2NvcmVEaXNwbGF5UG9zaXRpb25SZXF1ZXN0XHJcbn0gZnJvbSBcIi4vQ2xpZW50L0NvbW1hbmRzL0NvbW1hbmRcIjtcclxuaW1wb3J0IFRhYmxlIGZyb20gXCJAbWF0ZXJpYWwtdWkvY29yZS9UYWJsZVwiO1xyXG5pbXBvcnQgVGFibGVCb2R5IGZyb20gXCJAbWF0ZXJpYWwtdWkvY29yZS9UYWJsZUJvZHlcIjtcclxuaW1wb3J0IFRhYmxlQ2VsbCBmcm9tIFwiQG1hdGVyaWFsLXVpL2NvcmUvVGFibGVDZWxsXCI7XHJcbmltcG9ydCBUYWJsZUhlYWQgZnJvbSBcIkBtYXRlcmlhbC11aS9jb3JlL1RhYmxlSGVhZFwiO1xyXG5pbXBvcnQgVGFibGVSb3cgZnJvbSBcIkBtYXRlcmlhbC11aS9jb3JlL1RhYmxlUm93XCI7XHJcbmltcG9ydCBTZWFyY2hJY29uIGZyb20gXCJAbWF0ZXJpYWwtdWkvaWNvbnMvU2VhcmNoXCI7XHJcbmltcG9ydCBJY29uQnV0dG9uIGZyb20gXCJAbWF0ZXJpYWwtdWkvY29yZS9JY29uQnV0dG9uXCI7XHJcbmltcG9ydCB0aGVtZSBmcm9tIFwiLi90aGVtZVwiO1xyXG5cclxuY29uc3QgdXNlU3R5bGVzID0gbWFrZVN0eWxlcygodGhlbWU6IFRoZW1lKSA9PlxyXG4gIGNyZWF0ZVN0eWxlcyh7XHJcbiAgICBwYXBlclRhYmxlQ29udGFpbmVyOiB7XHJcbiAgICAgIG1hcmdpblRvcDogdGhlbWUuc3BhY2luZygzKSxcclxuICAgICAgd2lkdGg6IFwiMTAwJVwiLFxyXG4gICAgICBvdmVyZmxvd1g6IFwiYXV0b1wiLFxyXG4gICAgICBtYXJnaW5Cb3R0b206IHRoZW1lLnNwYWNpbmcoMiksXHJcbiAgICAgIGJhY2tncm91bmQ6IHRoZW1lLnBhbGV0dGUucHJpbWFyeS5saWdodFxyXG4gICAgfSxcclxuICAgIHRhYmxlQ2VsbDoge1xyXG4gICAgICBjdXJzb3I6IFwicG9pbnRlclwiXHJcbiAgICB9LFxyXG4gICAgcm9vdDoge1xyXG4gICAgICBwYWRkaW5nOiBcIjJweCA0cHhcIixcclxuICAgICAgZGlzcGxheTogXCJmbGV4XCIsXHJcbiAgICAgIGFsaWduSXRlbXM6IFwiY2VudGVyXCIsXHJcbiAgICAgIHdpZHRoOiA0MDAsXHJcbiAgICAgIGJhY2tncm91bmQ6IHRoZW1lLnBhbGV0dGUucHJpbWFyeS5saWdodFxyXG4gICAgfSxcclxuICAgIGlucHV0OiB7XHJcbiAgICAgIG1hcmdpbkxlZnQ6IHRoZW1lLnNwYWNpbmcoMSksXHJcbiAgICAgIGZsZXg6IDFcclxuICAgIH0sXHJcbiAgICBpY29uQnV0dG9uOiB7XHJcbiAgICAgIHBhZGRpbmc6IDEwXHJcbiAgICB9LFxyXG4gICAgZGl2aWRlcjoge1xyXG4gICAgICBoZWlnaHQ6IDI4LFxyXG4gICAgICBtYXJnaW46IDRcclxuICAgIH0sXHJcbiAgICBhY3RpdmVTY29yZVNlY3Rpb246IHtcclxuICAgICAgbWFyZ2luQm90dG9tOiB0aGVtZS5zcGFjaW5nKDIpXHJcbiAgICB9LFxyXG4gICAgc3RhZ2U6IHtcclxuICAgICAgd2lkdGg6IFwiMTAwJVwiLFxyXG4gICAgICBoZWlnaHQ6IFwiMTAwJVwiLFxyXG4gICAgICBwYWRkaW5nOiAxMCxcclxuICAgICAgcGFkZGluZ0xlZnQ6IDVcclxuICAgIH0sXHJcbiAgICBub1Njb3JlTG9hZGVkSWNvbjoge1xyXG4gICAgICBjb2xvcjogdGhlbWUucGFsZXR0ZS5wcmltYXJ5LmRhcmssXHJcbiAgICAgIHdpZHRoOiBcIjIzdndcIixcclxuICAgICAgaGVpZ2h0OiBcImF1dG9cIixcclxuICAgICAgdHJhbnNmb3JtOiBcInRyYW5zbGF0ZVkoLTEwJSlcIixcclxuICAgICAgb3BhY2l0eTogMC4zXHJcbiAgICB9XHJcbiAgfSlcclxuKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIFNjb3JlUGFuZSgpIHtcclxuICBjb25zdCBjbGFzc2VzID0gdXNlU3R5bGVzKCk7XHJcbiAgY29uc3Qgc3RhZ2VSZWYgPSB1c2VSZWYobnVsbCk7XHJcbiAgY29uc3QgW3BhZ2VTdmcsIHNldFBhZ2VTdmddID0gdXNlU3RhdGU8c3RyaW5nPihcIlwiKTtcclxuICBjb25zdCBbcGFnZU51bWJlciwgc2V0UGFnZU51bWJlcl0gPSB1c2VTdGF0ZSgxKTtcclxuICBjb25zdCBtZWFzdXJlSGlnaGxpZ2h0VHJlYmxlUmVmID0gdXNlUmVmKG51bGwpO1xyXG4gIGNvbnN0IG1lYXN1cmVIaWdobGlnaHRCYXNzUmVmID0gdXNlUmVmKG51bGwpO1xyXG4gIGNvbnN0IFttZWFzdXJlTnVtYmVycywgc2V0TWVhc3VyZU51bWJlcnNdID0gdXNlU3RhdGUoWzEsIDFdKTtcclxuICBjb25zdCBbXHJcbiAgICBiYXNzTWVhc3VyZUhpZ2hsaWdodERldGFpbHMsXHJcbiAgICBzZXRUcmVibGVNZWFzdXJlSGlnaGxpZ2h0RGV0YWlsc1xyXG4gIF0gPSB1c2VTdGF0ZSh7XHJcbiAgICB0b3A6IDAsXHJcbiAgICBsZWZ0OiAwLFxyXG4gICAgd2lkdGg6IDAsXHJcbiAgICBoZWlnaHQ6IDBcclxuICB9KTtcclxuICBjb25zdCBbXHJcbiAgICB0cmVibGVNZWFzdXJlSGlnaGxpZ2h0RGV0YWlscyxcclxuICAgIHNldEJhc3NNZWFzdXJlSGlnaGxpZ2h0RGV0YWlsc1xyXG4gIF0gPSB1c2VTdGF0ZSh7XHJcbiAgICB0b3A6IDAsXHJcbiAgICBsZWZ0OiAwLFxyXG4gICAgd2lkdGg6IDAsXHJcbiAgICBoZWlnaHQ6IDBcclxuICB9KTtcclxuXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGhpZ2hsaWdodE1lYXN1cmUoMSwgbWVhc3VyZU51bWJlcnNbMF0pO1xyXG4gICAgaGlnaGxpZ2h0TWVhc3VyZSgyLCBtZWFzdXJlTnVtYmVyc1swXSk7XHJcbiAgfSwgW21lYXN1cmVOdW1iZXJzXSk7XHJcblxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoXHJcbiAgICAgIFNpZ2h0UmVhZGVyQ2xpZW50Lkluc3RhbmNlLlNjb3JlLmxlbmd0aCA9PT0gMCB8fFxyXG4gICAgICAhc3RhZ2VSZWYgfHxcclxuICAgICAgIXN0YWdlUmVmLmN1cnJlbnRcclxuICAgICkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHN0YWdlQm91bmRzID0gKHN0YWdlUmVmIVxyXG4gICAgICAuY3VycmVudCEgYXMgSFRNTEVsZW1lbnQpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG5cclxuICAgIFNpZ2h0UmVhZGVyQ2xpZW50Lkluc3RhbmNlLnNldHVwU2NvcmUoe1xyXG4gICAgICBwYWdlSGVpZ2h0OiBzdGFnZUJvdW5kcy5oZWlnaHQgKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyxcclxuICAgICAgcGFnZVdpZHRoOiBzdGFnZUJvdW5kcy53aWR0aCAqIDMsXHJcbiAgICAgIHNjYWxlOiAxMDAgLyogU2NhbGUgMTAwIG1lYW5zIHBhZ2VIZWlnaHQgYW5kIHBhZ2VXaWR0aCBhcmUgcGl4ZWwgdW5pdHM6IGh0dHBzOi8vZ2l0aHViLmNvbS9yaXNtLWNoL3Zlcm92aW8vaXNzdWVzLzEwNTUgKi8sXHJcbiAgICAgIGFkanVzdFBhZ2VIZWlnaHQ6IGZhbHNlXHJcbiAgICB9KVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHJlcmVuZGVyU2NvcmUocGFnZU51bWJlcik7XHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICBoaWdobGlnaHRNZWFzdXJlKDEsIG1lYXN1cmVOdW1iZXJzWzBdKTtcclxuICAgICAgICBoaWdobGlnaHRNZWFzdXJlKDIsIG1lYXN1cmVOdW1iZXJzWzBdKTtcclxuICAgICAgfSk7XHJcbiAgfSwgW1NpZ2h0UmVhZGVyQ2xpZW50Lkluc3RhbmNlLlNjb3JlXSk7XHJcblxyXG4gIGFzeW5jIGZ1bmN0aW9uIHJlcmVuZGVyU2NvcmUocGFnZTogbnVtYmVyKSB7XHJcbiAgICBzZXRQYWdlTnVtYmVyKHBhZ2UpO1xyXG4gICAgY29uc29sZS5sb2coXCJSZW5kZXJpbmcgUGFnZTpcIiwgcGFnZSk7XHJcbiAgICByZXR1cm4gU2lnaHRSZWFkZXJDbGllbnQuSW5zdGFuY2UucmVuZGVyU2NvcmUocGFnZSkudGhlbigoc3ZnOiBhbnkpID0+IHtcclxuICAgICAgc2V0UGFnZVN2ZyhzdmcpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGlmICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAod2luZG93IGFzIGFueSkucmVyZW5kZXJTY29yZSA9IHJlcmVuZGVyU2NvcmU7XHJcbiAgfVxyXG5cclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgcmVyZW5kZXJTY29yZShwYWdlTnVtYmVyKTtcclxuICAgICh3aW5kb3cgYXMgYW55KS5wYWdlTnVtYmVyID0gcGFnZU51bWJlcjtcclxuICB9LCBbcGFnZU51bWJlcl0pO1xyXG4gIGlmICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAod2luZG93IGFzIGFueSkucGFnZU51bWJlciA9IHBhZ2VOdW1iZXI7XHJcbiAgfVxyXG5cclxuICBTaWdodFJlYWRlckNsaWVudC5JbnN0YW5jZS5zZXRTZXRTY29yZURpc3BsYXlQb3NpdGlvblJlcXVlc3RlZENhbGxiYWNrKFxyXG4gICAgb25TZXRTY29yZURpc3BsYXlQb3NpdGlvblJlcXVlc3RlZFxyXG4gICk7XHJcblxyXG4gIGZ1bmN0aW9uIG9uU2V0U2NvcmVEaXNwbGF5UG9zaXRpb25SZXF1ZXN0ZWQoXHJcbiAgICBjb21tYW5kOiBTZXRTY29yZURpc3BsYXlQb3NpdGlvblJlcXVlc3RcclxuICApIHtcclxuICAgIGNvbnNvbGUubG9nKFxyXG4gICAgICBcIlJlY2VpdmVkIGZpbmFsIHNldCBzY29yZSBkaXNwbGF5IHBvc2l0aW9uIHJlcXVlc3Q6XCIsXHJcbiAgICAgIGNvbW1hbmQuTWVhc3VyZU51bWJlcnMsXHJcbiAgICAgIGNvbW1hbmQuR3JvdXBJbmRpY2VzXHJcbiAgICApO1xyXG5cclxuICAgIHZhciBoaWdoZXN0UGxheWVkTWVhc3VyZSA9IE1hdGgubWF4KC4uLmNvbW1hbmQuTWVhc3VyZU51bWJlcnMpO1xyXG4gICAgdmFyIG1lYXN1cmVSYW5nZSA9IGdldFBhZ2VNZWFzdXJlUmFuZ2UoKTtcclxuICAgIHZhciBbbG93ZXN0TWVhc3VyZURpc3BsYXllZCwgaGlnaGVzdE1lYXN1cmVEaXNwbGF5ZWRdID0gbWVhc3VyZVJhbmdlO1xyXG4gICAgaWYgKGhpZ2hlc3RQbGF5ZWRNZWFzdXJlIDwgbG93ZXN0TWVhc3VyZURpc3BsYXllZCkge1xyXG4gICAgICBzZXRQYWdlTnVtYmVyKE1hdGgubWF4KDAsIHBhZ2VOdW1iZXIgLSAxKSk7XHJcbiAgICB9IGVsc2UgaWYgKGhpZ2hlc3RQbGF5ZWRNZWFzdXJlID4gaGlnaGVzdE1lYXN1cmVEaXNwbGF5ZWQpIHtcclxuICAgICAgc2V0UGFnZU51bWJlcihwYWdlTnVtYmVyICsgMSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBoaWdobGlnaHRNZWFzdXJlKDEsIGNvbW1hbmQuTWVhc3VyZU51bWJlcnNbMF0pO1xyXG4gICAgICBoaWdobGlnaHRNZWFzdXJlKDIsIGNvbW1hbmQuTWVhc3VyZU51bWJlcnNbMV0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZ2V0UGFnZU1lYXN1cmVSYW5nZSgpOiBbbnVtYmVyLCBudW1iZXJdIHtcclxuICAgIGNvbnN0IG5hdmlnYWJsZU1lYXN1cmVOdW1iZXJFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubU51bVwiKTtcclxuXHJcbiAgICBpZiAoIW5hdmlnYWJsZU1lYXN1cmVOdW1iZXJFbCkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFxyXG4gICAgICAgIFwiQ2Fubm90IGhpZ2hsaWdodCBtZWFzdXJlIGJlY2F1c2Ugbm8gbWVhc3VyZSBudW1iZXJzIGFyZSBwcmVzZW50IG9uIGFueSBzeXN0ZW0gb24gdGhlIHBhZ2UuXCJcclxuICAgICAgKTtcclxuICAgICAgcmV0dXJuIFstMSwgLTFdO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG5hdmlnYWJsZU1lYXN1cmVOdW1iZXIgPSBuYXZpZ2FibGVNZWFzdXJlTnVtYmVyRWwudGV4dENvbnRlbnRcclxuICAgICAgPyArbmF2aWdhYmxlTWVhc3VyZU51bWJlckVsLnRleHRDb250ZW50LnRyaW0oKVxyXG4gICAgICA6IC0xO1xyXG5cclxuICAgIGlmIChuYXZpZ2FibGVNZWFzdXJlTnVtYmVyID09PSAtMSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFxyXG4gICAgICAgIFwiRm91bmQgbWVhc3VyZSBudW1iZXIgZWxlbWVudCAubU51bSwgYnV0IGl0IGhhcyBubyB0ZXh0IGNvbnRlbnQgc28gY2Fubm90IGV4dHJhY3QgbWVhc3VyZSBudW1iZXIuXCJcclxuICAgICAgKTtcclxuICAgICAgcmV0dXJuIFstMSwgLTFdO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG5hdmlnYWJsZU1lYXN1cmVFbCA9IG5hdmlnYWJsZU1lYXN1cmVOdW1iZXJFbC5jbG9zZXN0KFwiLm1lYXN1cmVcIik7XHJcbiAgICBjb25zdCBwYWdlTWVhc3VyZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1lYXN1cmVcIik7XHJcblxyXG4gICAgY29uc3QgbmF2aWdhYmxlTWVhc3VyZU51bWJlckVsSW5kZXggPSAtMTtcclxuXHJcbiAgICBsZXQgbWVhc3VyZVJhbmdlTG93ID0gMDtcclxuICAgIGxldCBtZWFzdXJlUmFuZ2VIaWdoID0gMDtcclxuXHJcbiAgICBsZXQgbWVhc3VyZXNCZWZvcmVOYXZpZ2FibGUgPSAwO1xyXG4gICAgbGV0IG1lYXN1cmVzQWZ0ZXJOYXZpZ2FibGUgPSAwO1xyXG5cclxuICAgIGxldCBmb3VuZFRhcmdldE1lYXN1cmVFbCA9IGZhbHNlO1xyXG4gICAgcGFnZU1lYXN1cmVzLmZvckVhY2gobWVhc3VyZUVsID0+IHtcclxuICAgICAgaWYgKGZvdW5kVGFyZ2V0TWVhc3VyZUVsKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAobWVhc3VyZUVsID09PSBuYXZpZ2FibGVNZWFzdXJlRWwpIHtcclxuICAgICAgICBtZWFzdXJlc0FmdGVyTmF2aWdhYmxlID1cclxuICAgICAgICAgIHBhZ2VNZWFzdXJlcy5sZW5ndGggLSBtZWFzdXJlc0JlZm9yZU5hdmlnYWJsZSAtIDE7XHJcbiAgICAgICAgZm91bmRUYXJnZXRNZWFzdXJlRWwgPSB0cnVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIG1lYXN1cmVzQmVmb3JlTmF2aWdhYmxlICs9IDE7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIG1lYXN1cmVSYW5nZUxvdyA9IG5hdmlnYWJsZU1lYXN1cmVOdW1iZXIgLSBtZWFzdXJlc0JlZm9yZU5hdmlnYWJsZTtcclxuICAgIG1lYXN1cmVSYW5nZUhpZ2ggPSBuYXZpZ2FibGVNZWFzdXJlTnVtYmVyICsgbWVhc3VyZXNBZnRlck5hdmlnYWJsZTtcclxuXHJcbiAgICByZXR1cm4gW21lYXN1cmVSYW5nZUxvdywgbWVhc3VyZVJhbmdlSGlnaF07XHJcbiAgfVxyXG4gIGlmICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAod2luZG93IGFzIGFueSkuZ2V0UGFnZU1lYXN1cmVSYW5nZSA9IGdldFBhZ2VNZWFzdXJlUmFuZ2U7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBoaWdobGlnaHRNZWFzdXJlKHN0YWZmOiBudW1iZXIsIHRhcmdldE1lYXN1cmVOdW06IG51bWJlcikge1xyXG4gICAgaWYgKFNpZ2h0UmVhZGVyQ2xpZW50Lkluc3RhbmNlLlNjb3JlLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgW21lYXN1cmVSYW5nZUxvdywgbWVhc3VyZVJhbmdlSGlnaF0gPSBnZXRQYWdlTWVhc3VyZVJhbmdlKCk7XHJcblxyXG4gICAgaWYgKFxyXG4gICAgICB0YXJnZXRNZWFzdXJlTnVtIDwgbWVhc3VyZVJhbmdlTG93IHx8XHJcbiAgICAgIHRhcmdldE1lYXN1cmVOdW0gPiBtZWFzdXJlUmFuZ2VIaWdoXHJcbiAgICApIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcclxuICAgICAgICBgQ2Fubm90IGhpZ2hsaWdodCBtZWFzdXJlICR7dGFyZ2V0TWVhc3VyZU51bX0uIFRoaXMgcGFnZSBvbmx5IHNob3dzIG1lYXN1cmVzICR7bWVhc3VyZVJhbmdlTG93fSAtICR7bWVhc3VyZVJhbmdlSGlnaH0uYFxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJlbGF0aXZlTWVhc3VyZU51bSA9IHRhcmdldE1lYXN1cmVOdW0gLSBtZWFzdXJlUmFuZ2VMb3c7XHJcbiAgICBjb25zdCBtZWFzdXJlRWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgLm1lYXN1cmVgKTtcclxuICAgIGNvbnN0IG1lYXN1cmVFbCA9IG1lYXN1cmVFbHNbcmVsYXRpdmVNZWFzdXJlTnVtXTtcclxuXHJcbiAgICBpZiAoIW1lYXN1cmVFbCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc3RhZmZFbCA9IG1lYXN1cmVFbC5xdWVyeVNlbGVjdG9yQWxsKFwiLnN0YWZmXCIpW3N0YWZmIC0gMV07XHJcbiAgICBpZiAoIXN0YWZmRWwpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcclxuICAgICAgICBcIkNvdWxkIG5vdCBoaWdobGlnaHQgc3RhZmZcIixcclxuICAgICAgICBzdGFmZixcclxuICAgICAgICBcIm9mIG1lYXN1cmVcIixcclxuICAgICAgICB0YXJnZXRNZWFzdXJlTnVtLFxyXG4gICAgICAgIFwiLiBUaGUgbWVhc3VyZSBlbGVtZW50IHdhczpcIixcclxuICAgICAgICBtZWFzdXJlRWxcclxuICAgICAgKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN0YWZmQm91bmRpbmdCb3ggPSBzdGFmZkVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgaWYgKHN0YWZmID09PSAxKSB7XHJcbiAgICAgIHNldFRyZWJsZU1lYXN1cmVIaWdobGlnaHREZXRhaWxzKHtcclxuICAgICAgICB0b3A6IHN0YWZmQm91bmRpbmdCb3gudG9wLFxyXG4gICAgICAgIGxlZnQ6IHN0YWZmQm91bmRpbmdCb3gubGVmdCxcclxuICAgICAgICB3aWR0aDogc3RhZmZCb3VuZGluZ0JveC53aWR0aCxcclxuICAgICAgICBoZWlnaHQ6IHN0YWZmQm91bmRpbmdCb3guaGVpZ2h0XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIGlmIChzdGFmZiA9PT0gMikge1xyXG4gICAgICBzZXRCYXNzTWVhc3VyZUhpZ2hsaWdodERldGFpbHMoe1xyXG4gICAgICAgIHRvcDogc3RhZmZCb3VuZGluZ0JveC50b3AsXHJcbiAgICAgICAgbGVmdDogc3RhZmZCb3VuZGluZ0JveC5sZWZ0LFxyXG4gICAgICAgIHdpZHRoOiBzdGFmZkJvdW5kaW5nQm94LndpZHRoLFxyXG4gICAgICAgIGhlaWdodDogc3RhZmZCb3VuZGluZ0JveC5oZWlnaHRcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiVW5rbm93biBzdGFmZlwiLCBzdGFmZiwgXCJ0byBoaWdobGlnaHQgbWVhc3VyZSBmb3IuXCIpO1xyXG4gICAgfVxyXG4gIH1cclxuICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgKHdpbmRvdyBhcyBhbnkpLmhpZ2hsaWdodE1lYXN1cmUgPSBoaWdobGlnaHRNZWFzdXJlO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIChcclxuICAgIDxCb3ggZmxleEdyb3c9ezF9IGZsZXhTaHJpbms9ezB9IG1heFdpZHRoPXsxMDI0fT5cclxuICAgICAge3BhZ2VTdmcubGVuZ3RoID09PSAwICYmIChcclxuICAgICAgICA8Qm94XHJcbiAgICAgICAgICBkaXNwbGF5PVwiZmxleFwiXHJcbiAgICAgICAgICBhbGlnbkl0ZW1zPVwiY2VudGVyXCJcclxuICAgICAgICAgIGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCJcclxuICAgICAgICAgIGhlaWdodD1cIjEwMCVcIlxyXG4gICAgICAgID5cclxuICAgICAgICAgIDxNZW51Qm9va1R3b1RvbmVJY29uIGNsYXNzTmFtZT17Y2xhc3Nlcy5ub1Njb3JlTG9hZGVkSWNvbn0gLz5cclxuICAgICAgICA8L0JveD5cclxuICAgICAgKX1cclxuICAgICAgPHN0eWxlIGpzeCBnbG9iYWw+e2BcclxuICAgICAgICAvKiBIaWRlIGRvdWJsZSBkYXNoZWQgbGluZXMgYWJvdmUgZWFjaCBzeXN0ZW0gKi9cclxuICAgICAgICAjc3RhZ2UgLnN5c3RlbSA+IHBvbHlnb24ge1xyXG4gICAgICAgICAgZGlzcGxheTogbm9uZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qIEhpZGUgYWxsIHJlc3RzICovXHJcbiAgICAgICAgI3N0YWdlIC5yZXN0IHtcclxuICAgICAgICAgIGRpc3BsYXk6IG5vbmU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKiBIaWRlIGluc3RydW1lbnQgbmFtZXMgb24gZWFjaCBzeXN0ZW0gKi9cclxuICAgICAgICAvLyAjc3RhZ2UgLnN5c3RlbSA+IC5sYWJlbCB7XHJcbiAgICAgICAgLy8gICBkaXNwbGF5OiBub25lO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICAvLyAjc3RhZ2UgLnN5c3RlbSA+IC5sYWJlbEFiYnIge1xyXG4gICAgICAgIC8vICAgZGlzcGxheTogbm9uZTtcclxuICAgICAgICAvLyB9XHJcbiAgICAgIGB9PC9zdHlsZT5cclxuICAgICAgPGRpdlxyXG4gICAgICAgIGlkPVwibWVhc3VyZS1oaWdobGlnaHQtc3RhZmYtdHJlYmxlXCJcclxuICAgICAgICByZWY9e21lYXN1cmVIaWdobGlnaHRUcmVibGVSZWZ9XHJcbiAgICAgICAgc3R5bGU9e3tcclxuICAgICAgICAgIHBvc2l0aW9uOiBcImFic29sdXRlXCIsXHJcbiAgICAgICAgICB3aWR0aDogdHJlYmxlTWVhc3VyZUhpZ2hsaWdodERldGFpbHMud2lkdGgsXHJcbiAgICAgICAgICBoZWlnaHQ6IHRyZWJsZU1lYXN1cmVIaWdobGlnaHREZXRhaWxzLmhlaWdodCxcclxuICAgICAgICAgIHRvcDogdHJlYmxlTWVhc3VyZUhpZ2hsaWdodERldGFpbHMudG9wLFxyXG4gICAgICAgICAgbGVmdDogdHJlYmxlTWVhc3VyZUhpZ2hsaWdodERldGFpbHMubGVmdCxcclxuICAgICAgICAgIGJhY2tncm91bmQ6IFwiIzQ1N2M5N1wiLFxyXG4gICAgICAgICAgb3BhY2l0eTogMC4yNSxcclxuICAgICAgICAgIGJvcmRlclJhZGl1czogMCxcclxuICAgICAgICAgIGJveFNoYWRvdzogYDAgMCAwIDFweCAjZDRkNGQ1LCAwIDJweCA0cHggMCByZ2JhKDM0LDM2LDM4LC4xMiksIDAgMnB4IDEwcHggMCByZ2JhKDM0LDM2LDM4LC4xNSlgXHJcbiAgICAgICAgfX1cclxuICAgICAgLz5cclxuICAgICAgPGRpdlxyXG4gICAgICAgIGlkPVwibWVhc3VyZS1oaWdobGlnaHQtc3RhZmYtYmFzc1wiXHJcbiAgICAgICAgcmVmPXttZWFzdXJlSGlnaGxpZ2h0QmFzc1JlZn1cclxuICAgICAgICBzdHlsZT17e1xyXG4gICAgICAgICAgcG9zaXRpb246IFwiYWJzb2x1dGVcIixcclxuICAgICAgICAgIHdpZHRoOiBiYXNzTWVhc3VyZUhpZ2hsaWdodERldGFpbHMud2lkdGgsXHJcbiAgICAgICAgICBoZWlnaHQ6IGJhc3NNZWFzdXJlSGlnaGxpZ2h0RGV0YWlscy5oZWlnaHQsXHJcbiAgICAgICAgICB0b3A6IGJhc3NNZWFzdXJlSGlnaGxpZ2h0RGV0YWlscy50b3AsXHJcbiAgICAgICAgICBsZWZ0OiBiYXNzTWVhc3VyZUhpZ2hsaWdodERldGFpbHMubGVmdCxcclxuICAgICAgICAgIGJhY2tncm91bmQ6IFwiIzQ1N2M5N1wiLFxyXG4gICAgICAgICAgb3BhY2l0eTogMC4yNSxcclxuICAgICAgICAgIGJvcmRlclJhZGl1czogMCxcclxuICAgICAgICAgIGJveFNoYWRvdzogYDAgMCAwIDFweCAjZDRkNGQ1LCAwIDJweCA0cHggMCByZ2JhKDM0LDM2LDM4LC4xMiksIDAgMnB4IDEwcHggMCByZ2JhKDM0LDM2LDM4LC4xNSlgXHJcbiAgICAgICAgfX1cclxuICAgICAgLz5cclxuICAgICAgPGRpdlxyXG4gICAgICAgIGlkPVwic3RhZ2VcIlxyXG4gICAgICAgIHJlZj17c3RhZ2VSZWZ9XHJcbiAgICAgICAgY2xhc3NOYW1lPXtjbGFzc2VzLnN0YWdlfVxyXG4gICAgICAgIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MPXt7IF9faHRtbDogcGFnZVN2ZyB9fVxyXG4gICAgICAvPlxyXG4gICAgPC9Cb3g+XHJcbiAgKTtcclxufVxyXG4iXX0= */\\n/*@ sourceURL=C:\\\\code\\\\sightreader\\\\performer\\\\src\\\\ScorePane.tsx */\"), __jsx(\"div\", {\n    id: \"measure-highlight-staff-treble\",\n    ref: measureHighlightTrebleRef,\n    style: {\n      position: \"absolute\",\n      width: trebleMeasureHighlightDetails.width,\n      height: trebleMeasureHighlightDetails.height,\n      top: trebleMeasureHighlightDetails.top,\n      left: trebleMeasureHighlightDetails.left,\n      background: \"#457c97\",\n      opacity: 0.25,\n      borderRadius: 0,\n      boxShadow: `0 0 0 1px #d4d4d5, 0 2px 4px 0 rgba(34,36,38,.12), 0 2px 10px 0 rgba(34,36,38,.15)`\n    },\n    className: \"jsx-918444649\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 346\n    },\n    __self: this\n  }), __jsx(\"div\", {\n    id: \"measure-highlight-staff-bass\",\n    ref: measureHighlightBassRef,\n    style: {\n      position: \"absolute\",\n      width: bassMeasureHighlightDetails.width,\n      height: bassMeasureHighlightDetails.height,\n      top: bassMeasureHighlightDetails.top,\n      left: bassMeasureHighlightDetails.left,\n      background: \"#457c97\",\n      opacity: 0.25,\n      borderRadius: 0,\n      boxShadow: `0 0 0 1px #d4d4d5, 0 2px 4px 0 rgba(34,36,38,.12), 0 2px 10px 0 rgba(34,36,38,.15)`\n    },\n    className: \"jsx-918444649\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 361\n    },\n    __self: this\n  }), __jsx(\"div\", {\n    id: \"stage\",\n    ref: stageRef,\n    dangerouslySetInnerHTML: {\n      __html: pageSvg\n    },\n    className: \"jsx-918444649\" + \" \" + (classes.stage || \"\"),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 376\n    },\n    __self: this\n  }));\n}","map":{"version":3,"sources":["C:/code/sightreader/performer/src/ScorePane.tsx"],"names":["React","useState","useRef","useEffect","createStyles","makeStyles","Box","MenuBookTwoToneIcon","SightReaderClient","useStyles","theme","paperTableContainer","marginTop","spacing","width","overflowX","marginBottom","background","palette","primary","light","tableCell","cursor","root","padding","display","alignItems","input","marginLeft","flex","iconButton","divider","height","margin","activeScoreSection","stage","paddingLeft","noScoreLoadedIcon","color","dark","transform","opacity","ScorePane","classes","stageRef","pageSvg","setPageSvg","pageNumber","setPageNumber","measureHighlightTrebleRef","measureHighlightBassRef","measureNumbers","setMeasureNumbers","bassMeasureHighlightDetails","setTrebleMeasureHighlightDetails","top","left","trebleMeasureHighlightDetails","setBassMeasureHighlightDetails","highlightMeasure","Instance","Score","length","current","stageBounds","getBoundingClientRect","setupScore","pageHeight","window","devicePixelRatio","pageWidth","scale","adjustPageHeight","then","rerenderScore","page","console","log","renderScore","svg","setSetScoreDisplayPositionRequestedCallback","onSetScoreDisplayPositionRequested","command","MeasureNumbers","GroupIndices","highestPlayedMeasure","Math","max","measureRange","getPageMeasureRange","lowestMeasureDisplayed","highestMeasureDisplayed","navigableMeasureNumberEl","document","querySelector","error","navigableMeasureNumber","textContent","trim","navigableMeasureEl","closest","pageMeasures","querySelectorAll","navigableMeasureNumberElIndex","measureRangeLow","measureRangeHigh","measuresBeforeNavigable","measuresAfterNavigable","foundTargetMeasureEl","forEach","measureEl","staff","targetMeasureNum","relativeMeasureNum","measureEls","staffEl","staffBoundingBox","position","borderRadius","boxShadow","__html"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\r\nimport Container from \"@material-ui/core/Container\";\r\nimport {\r\n  createStyles,\r\n  Theme,\r\n  makeStyles,\r\n  rgbToHex\r\n} from \"@material-ui/core/styles\";\r\nimport AppBar from \"@material-ui/core/AppBar\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport AccountCircle from \"@material-ui/icons/AccountCircle\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport Menu from \"@material-ui/core/Menu\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport { Client } from \"../src/Client/Client\";\r\nimport SettingsInputSvideoTwoToneIcon from \"@material-ui/icons/SettingsInputSvideoTwoTone\";\r\nimport {\r\n  Fab,\r\n  Box,\r\n  Paper,\r\n  FormGroup,\r\n  FormControlLabel,\r\n  Switch,\r\n  InputBase\r\n} from \"@material-ui/core\";\r\nimport SettingsIcon from \"@material-ui/icons/Settings\";\r\nimport MenuIcon from \"@material-ui/icons/Menu\";\r\nimport MenuBookTwoToneIcon from \"@material-ui/icons/MenuBookTwoTone\";\r\nimport clsx from \"clsx\";\r\nimport { SightReaderClient } from \"./SightReaderClient\";\r\nimport {\r\n  EnumerateMidiDevicesResponse,\r\n  EnumerateScoresResponse,\r\n  SetScoreDisplayPositionRequest\r\n} from \"./Client/Commands/Command\";\r\nimport Table from \"@material-ui/core/Table\";\r\nimport TableBody from \"@material-ui/core/TableBody\";\r\nimport TableCell from \"@material-ui/core/TableCell\";\r\nimport TableHead from \"@material-ui/core/TableHead\";\r\nimport TableRow from \"@material-ui/core/TableRow\";\r\nimport SearchIcon from \"@material-ui/icons/Search\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport theme from \"./theme\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    paperTableContainer: {\r\n      marginTop: theme.spacing(3),\r\n      width: \"100%\",\r\n      overflowX: \"auto\",\r\n      marginBottom: theme.spacing(2),\r\n      background: theme.palette.primary.light\r\n    },\r\n    tableCell: {\r\n      cursor: \"pointer\"\r\n    },\r\n    root: {\r\n      padding: \"2px 4px\",\r\n      display: \"flex\",\r\n      alignItems: \"center\",\r\n      width: 400,\r\n      background: theme.palette.primary.light\r\n    },\r\n    input: {\r\n      marginLeft: theme.spacing(1),\r\n      flex: 1\r\n    },\r\n    iconButton: {\r\n      padding: 10\r\n    },\r\n    divider: {\r\n      height: 28,\r\n      margin: 4\r\n    },\r\n    activeScoreSection: {\r\n      marginBottom: theme.spacing(2)\r\n    },\r\n    stage: {\r\n      width: \"100%\",\r\n      height: \"100%\",\r\n      padding: 10,\r\n      paddingLeft: 5\r\n    },\r\n    noScoreLoadedIcon: {\r\n      color: theme.palette.primary.dark,\r\n      width: \"23vw\",\r\n      height: \"auto\",\r\n      transform: \"translateY(-10%)\",\r\n      opacity: 0.3\r\n    }\r\n  })\r\n);\r\n\r\nexport default function ScorePane() {\r\n  const classes = useStyles();\r\n  const stageRef = useRef(null);\r\n  const [pageSvg, setPageSvg] = useState<string>(\"\");\r\n  const [pageNumber, setPageNumber] = useState(1);\r\n  const measureHighlightTrebleRef = useRef(null);\r\n  const measureHighlightBassRef = useRef(null);\r\n  const [measureNumbers, setMeasureNumbers] = useState([1, 1]);\r\n  const [\r\n    bassMeasureHighlightDetails,\r\n    setTrebleMeasureHighlightDetails\r\n  ] = useState({\r\n    top: 0,\r\n    left: 0,\r\n    width: 0,\r\n    height: 0\r\n  });\r\n  const [\r\n    trebleMeasureHighlightDetails,\r\n    setBassMeasureHighlightDetails\r\n  ] = useState({\r\n    top: 0,\r\n    left: 0,\r\n    width: 0,\r\n    height: 0\r\n  });\r\n\r\n  useEffect(() => {\r\n    highlightMeasure(1, measureNumbers[0]);\r\n    highlightMeasure(2, measureNumbers[0]);\r\n  }, [measureNumbers]);\r\n\r\n  useEffect(() => {\r\n    if (\r\n      SightReaderClient.Instance.Score.length === 0 ||\r\n      !stageRef ||\r\n      !stageRef.current\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    var stageBounds = (stageRef!\r\n      .current! as HTMLElement).getBoundingClientRect();\r\n\r\n    SightReaderClient.Instance.setupScore({\r\n      pageHeight: stageBounds.height * window.devicePixelRatio,\r\n      pageWidth: stageBounds.width * 3,\r\n      scale: 100 /* Scale 100 means pageHeight and pageWidth are pixel units: https://github.com/rism-ch/verovio/issues/1055 */,\r\n      adjustPageHeight: false\r\n    })\r\n      .then(() => {\r\n        return rerenderScore(pageNumber);\r\n      })\r\n      .then(() => {\r\n        highlightMeasure(1, measureNumbers[0]);\r\n        highlightMeasure(2, measureNumbers[0]);\r\n      });\r\n  }, [SightReaderClient.Instance.Score]);\r\n\r\n  async function rerenderScore(page: number) {\r\n    setPageNumber(page);\r\n    console.log(\"Rendering Page:\", page);\r\n    return SightReaderClient.Instance.renderScore(page).then((svg: any) => {\r\n      setPageSvg(svg);\r\n    });\r\n  }\r\n  if (typeof window !== \"undefined\") {\r\n    (window as any).rerenderScore = rerenderScore;\r\n  }\r\n\r\n  useEffect(() => {\r\n    rerenderScore(pageNumber);\r\n    (window as any).pageNumber = pageNumber;\r\n  }, [pageNumber]);\r\n  if (typeof window !== \"undefined\") {\r\n    (window as any).pageNumber = pageNumber;\r\n  }\r\n\r\n  SightReaderClient.Instance.setSetScoreDisplayPositionRequestedCallback(\r\n    onSetScoreDisplayPositionRequested\r\n  );\r\n\r\n  function onSetScoreDisplayPositionRequested(\r\n    command: SetScoreDisplayPositionRequest\r\n  ) {\r\n    console.log(\r\n      \"Received final set score display position request:\",\r\n      command.MeasureNumbers,\r\n      command.GroupIndices\r\n    );\r\n\r\n    var highestPlayedMeasure = Math.max(...command.MeasureNumbers);\r\n    var measureRange = getPageMeasureRange();\r\n    var [lowestMeasureDisplayed, highestMeasureDisplayed] = measureRange;\r\n    if (highestPlayedMeasure < lowestMeasureDisplayed) {\r\n      setPageNumber(Math.max(0, pageNumber - 1));\r\n    } else if (highestPlayedMeasure > highestMeasureDisplayed) {\r\n      setPageNumber(pageNumber + 1);\r\n    } else {\r\n      highlightMeasure(1, command.MeasureNumbers[0]);\r\n      highlightMeasure(2, command.MeasureNumbers[1]);\r\n    }\r\n  }\r\n\r\n  function getPageMeasureRange(): [number, number] {\r\n    const navigableMeasureNumberEl = document.querySelector(\".mNum\");\r\n\r\n    if (!navigableMeasureNumberEl) {\r\n      console.error(\r\n        \"Cannot highlight measure because no measure numbers are present on any system on the page.\"\r\n      );\r\n      return [-1, -1];\r\n    }\r\n\r\n    const navigableMeasureNumber = navigableMeasureNumberEl.textContent\r\n      ? +navigableMeasureNumberEl.textContent.trim()\r\n      : -1;\r\n\r\n    if (navigableMeasureNumber === -1) {\r\n      console.error(\r\n        \"Found measure number element .mNum, but it has no text content so cannot extract measure number.\"\r\n      );\r\n      return [-1, -1];\r\n    }\r\n\r\n    const navigableMeasureEl = navigableMeasureNumberEl.closest(\".measure\");\r\n    const pageMeasures = document.querySelectorAll(\".measure\");\r\n\r\n    const navigableMeasureNumberElIndex = -1;\r\n\r\n    let measureRangeLow = 0;\r\n    let measureRangeHigh = 0;\r\n\r\n    let measuresBeforeNavigable = 0;\r\n    let measuresAfterNavigable = 0;\r\n\r\n    let foundTargetMeasureEl = false;\r\n    pageMeasures.forEach(measureEl => {\r\n      if (foundTargetMeasureEl) {\r\n        return;\r\n      }\r\n\r\n      if (measureEl === navigableMeasureEl) {\r\n        measuresAfterNavigable =\r\n          pageMeasures.length - measuresBeforeNavigable - 1;\r\n        foundTargetMeasureEl = true;\r\n      } else {\r\n        measuresBeforeNavigable += 1;\r\n      }\r\n    });\r\n\r\n    measureRangeLow = navigableMeasureNumber - measuresBeforeNavigable;\r\n    measureRangeHigh = navigableMeasureNumber + measuresAfterNavigable;\r\n\r\n    return [measureRangeLow, measureRangeHigh];\r\n  }\r\n  if (typeof window !== \"undefined\") {\r\n    (window as any).getPageMeasureRange = getPageMeasureRange;\r\n  }\r\n\r\n  function highlightMeasure(staff: number, targetMeasureNum: number) {\r\n    if (SightReaderClient.Instance.Score.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const [measureRangeLow, measureRangeHigh] = getPageMeasureRange();\r\n\r\n    if (\r\n      targetMeasureNum < measureRangeLow ||\r\n      targetMeasureNum > measureRangeHigh\r\n    ) {\r\n      console.error(\r\n        `Cannot highlight measure ${targetMeasureNum}. This page only shows measures ${measureRangeLow} - ${measureRangeHigh}.`\r\n      );\r\n    }\r\n\r\n    const relativeMeasureNum = targetMeasureNum - measureRangeLow;\r\n    const measureEls = document.querySelectorAll(`.measure`);\r\n    const measureEl = measureEls[relativeMeasureNum];\r\n\r\n    if (!measureEl) {\r\n      return;\r\n    }\r\n\r\n    const staffEl = measureEl.querySelectorAll(\".staff\")[staff - 1];\r\n    if (!staffEl) {\r\n      console.error(\r\n        \"Could not highlight staff\",\r\n        staff,\r\n        \"of measure\",\r\n        targetMeasureNum,\r\n        \". The measure element was:\",\r\n        measureEl\r\n      );\r\n      return;\r\n    }\r\n\r\n    const staffBoundingBox = staffEl.getBoundingClientRect();\r\n    if (staff === 1) {\r\n      setTrebleMeasureHighlightDetails({\r\n        top: staffBoundingBox.top,\r\n        left: staffBoundingBox.left,\r\n        width: staffBoundingBox.width,\r\n        height: staffBoundingBox.height\r\n      });\r\n    } else if (staff === 2) {\r\n      setBassMeasureHighlightDetails({\r\n        top: staffBoundingBox.top,\r\n        left: staffBoundingBox.left,\r\n        width: staffBoundingBox.width,\r\n        height: staffBoundingBox.height\r\n      });\r\n    } else {\r\n      console.error(\"Unknown staff\", staff, \"to highlight measure for.\");\r\n    }\r\n  }\r\n  if (typeof window !== \"undefined\") {\r\n    (window as any).highlightMeasure = highlightMeasure;\r\n  }\r\n\r\n  return (\r\n    <Box flexGrow={1} flexShrink={0} maxWidth={1024}>\r\n      {pageSvg.length === 0 && (\r\n        <Box\r\n          display=\"flex\"\r\n          alignItems=\"center\"\r\n          justifyContent=\"center\"\r\n          height=\"100%\"\r\n        >\r\n          <MenuBookTwoToneIcon className={classes.noScoreLoadedIcon} />\r\n        </Box>\r\n      )}\r\n      <style jsx global>{`\r\n        /* Hide double dashed lines above each system */\r\n        #stage .system > polygon {\r\n          display: none;\r\n        }\r\n\r\n        /* Hide all rests */\r\n        #stage .rest {\r\n          display: none;\r\n        }\r\n\r\n        /* Hide instrument names on each system */\r\n        // #stage .system > .label {\r\n        //   display: none;\r\n        // }\r\n        // #stage .system > .labelAbbr {\r\n        //   display: none;\r\n        // }\r\n      `}</style>\r\n      <div\r\n        id=\"measure-highlight-staff-treble\"\r\n        ref={measureHighlightTrebleRef}\r\n        style={{\r\n          position: \"absolute\",\r\n          width: trebleMeasureHighlightDetails.width,\r\n          height: trebleMeasureHighlightDetails.height,\r\n          top: trebleMeasureHighlightDetails.top,\r\n          left: trebleMeasureHighlightDetails.left,\r\n          background: \"#457c97\",\r\n          opacity: 0.25,\r\n          borderRadius: 0,\r\n          boxShadow: `0 0 0 1px #d4d4d5, 0 2px 4px 0 rgba(34,36,38,.12), 0 2px 10px 0 rgba(34,36,38,.15)`\r\n        }}\r\n      />\r\n      <div\r\n        id=\"measure-highlight-staff-bass\"\r\n        ref={measureHighlightBassRef}\r\n        style={{\r\n          position: \"absolute\",\r\n          width: bassMeasureHighlightDetails.width,\r\n          height: bassMeasureHighlightDetails.height,\r\n          top: bassMeasureHighlightDetails.top,\r\n          left: bassMeasureHighlightDetails.left,\r\n          background: \"#457c97\",\r\n          opacity: 0.25,\r\n          borderRadius: 0,\r\n          boxShadow: `0 0 0 1px #d4d4d5, 0 2px 4px 0 rgba(34,36,38,.12), 0 2px 10px 0 rgba(34,36,38,.15)`\r\n        }}\r\n      />\r\n      <div\r\n        id=\"stage\"\r\n        ref={stageRef}\r\n        className={classes.stage}\r\n        dangerouslySetInnerHTML={{ __html: pageSvg }}\r\n      />\r\n    </Box>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}